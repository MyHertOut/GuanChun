<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æµè§ˆå™¨æ¸²æŸ“åº•å±‚é€»è¾‘å¯è§†åŒ– Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Courier New", monospace;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }

      h1 {
        text-align: center;
        color: #667eea;
        margin-bottom: 2rem;
        font-size: 2.5rem;
      }

      .controls {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        justify-content: center;
      }

      button {
        padding: 1rem 2rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        color: white;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .btn-start {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .btn-step {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .btn-reset {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .stage-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .stage {
        border: 3px solid #e2e8f0;
        border-radius: 12px;
        padding: 1.5rem;
        background: #f8fafc;
        min-height: 300px;
        transition: all 0.3s;
      }

      .stage.active {
        border-color: #667eea;
        background: #ebf4ff;
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
      }

      .stage h2 {
        color: #667eea;
        margin-bottom: 1rem;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .stage-content {
        font-size: 0.9rem;
        line-height: 1.6;
      }

      .tree-node {
        margin-left: 1.5rem;
        padding: 0.5rem;
        border-left: 2px solid #cbd5e0;
        opacity: 0;
        transform: translateX(-20px);
        transition: all 0.4s;
      }

      .tree-node.visible {
        opacity: 1;
        transform: translateX(0);
      }

      .tree-node-name {
        color: #2d3748;
        font-weight: bold;
      }

      .tree-node-type {
        color: #718096;
        font-size: 0.85rem;
      }

      .css-rule {
        background: #1a202c;
        color: #68d391;
        padding: 0.5rem;
        margin: 0.5rem 0;
        border-radius: 4px;
        opacity: 0;
        transform: translateX(-20px);
        transition: all 0.4s;
      }

      .css-rule.visible {
        opacity: 1;
        transform: translateX(0);
      }

      .render-item {
        background: white;
        border: 2px solid #667eea;
        padding: 1rem;
        margin: 0.5rem 0;
        border-radius: 8px;
        opacity: 0;
        transform: scale(0.9);
        transition: all 0.4s;
      }

      .render-item.visible {
        opacity: 1;
        transform: scale(1);
      }

      .layout-box {
        border: 2px dashed #4299e1;
        padding: 0.5rem;
        margin: 0.5rem 0;
        position: relative;
        opacity: 0;
        transition: all 0.5s;
      }

      .layout-box.visible {
        opacity: 1;
      }

      .layout-info {
        font-size: 0.75rem;
        color: #4299e1;
        position: absolute;
        top: -20px;
        right: 5px;
        background: white;
        padding: 2px 5px;
        border-radius: 3px;
      }

      .paint-layer {
        background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%);
        border: 2px solid #667eea;
        padding: 1rem;
        margin: 0.5rem 0;
        border-radius: 8px;
        opacity: 0;
        transition: all 0.5s;
      }

      .paint-layer.visible {
        opacity: 1;
        animation: paintPulse 1s ease-in-out;
      }

      @keyframes paintPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .composite-layer {
        background: white;
        border: 3px solid #48bb78;
        padding: 1rem;
        margin: 0.5rem 0;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.6s;
      }

      .composite-layer.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .final-render {
        margin-top: 2rem;
        padding: 2rem;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 12px;
        border: 3px solid #48bb78;
        min-height: 300px;
      }

      .final-render h2 {
        color: #48bb78;
        text-align: center;
        margin-bottom: 1.5rem;
      }

      .rendered-content {
        opacity: 0;
        transition: opacity 1s;
      }

      .rendered-content.visible {
        opacity: 1;
      }

      .step-indicator {
        text-align: center;
        font-size: 1.2rem;
        color: #667eea;
        font-weight: bold;
        margin-bottom: 1rem;
        padding: 1rem;
        background: #ebf4ff;
        border-radius: 8px;
      }

      .code-sample {
        background: #1a202c;
        color: #68d391;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        overflow-x: auto;
      }

      .highlight {
        animation: highlight 0.8s ease-in-out;
      }

      @keyframes highlight {
        0%,
        100% {
          background-color: transparent;
        }
        50% {
          background-color: #fef3c7;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ” æµè§ˆå™¨æ¸²æŸ“åº•å±‚é€»è¾‘å¯è§†åŒ–</h1>

      <div class="code-sample">
        <div>ğŸ“„ æºHTMLä»£ç ï¼š</div>
        <pre>
&lt;div class="container"&gt;
  &lt;h1 class="title"&gt;Hello World&lt;/h1&gt;
  &lt;p class="text"&gt;è¿™æ˜¯ä¸€æ®µæ–‡æœ¬&lt;/p&gt;
&lt;/div&gt;</pre
        >
      </div>

      <div class="controls">
        <button class="btn-start" onclick="runFullDemo()">â–¶ï¸ è‡ªåŠ¨æ¼”ç¤º</button>
        <button class="btn-step" onclick="nextStep()">â­ï¸ å•æ­¥æ‰§è¡Œ</button>
        <button class="btn-reset" onclick="resetDemo()">ğŸ”„ é‡ç½®</button>
      </div>

      <div class="step-indicator" id="stepIndicator">
        å‡†å¤‡å¼€å§‹...ç‚¹å‡»"è‡ªåŠ¨æ¼”ç¤º"æˆ–"å•æ­¥æ‰§è¡Œ"
      </div>

      <div class="stage-container">
        <!-- Stage 1: HTML Parsing & DOM -->
        <div class="stage" id="stage1">
          <h2>1ï¸âƒ£ HTML è§£æ â†’ DOM æ ‘</h2>
          <div class="stage-content" id="domContent">
            <div style="margin-bottom: 1rem; color: #718096">
              HTML è§£æå™¨å°†å­—èŠ‚æµè½¬æ¢ä¸º DOM æ ‘...
            </div>
          </div>
        </div>

        <!-- Stage 2: CSS Parsing & CSSOM -->
        <div class="stage" id="stage2">
          <h2>2ï¸âƒ£ CSS è§£æ â†’ CSSOM</h2>
          <div class="stage-content" id="cssomContent">
            <div style="margin-bottom: 1rem; color: #718096">
              CSS è§£æå™¨æ„å»º CSSOM æ ‘...
            </div>
          </div>
        </div>

        <!-- Stage 3: Render Tree -->
        <div class="stage" id="stage3">
          <h2>3ï¸âƒ£ æ„å»ºæ¸²æŸ“æ ‘</h2>
          <div class="stage-content" id="renderTreeContent">
            <div style="margin-bottom: 1rem; color: #718096">
              åˆå¹¶ DOM å’Œ CSSOM...
            </div>
          </div>
        </div>

        <!-- Stage 4: Layout -->
        <div class="stage" id="stage4">
          <h2>4ï¸âƒ£ Layout (å¸ƒå±€)</h2>
          <div class="stage-content" id="layoutContent">
            <div style="margin-bottom: 1rem; color: #718096">
              è®¡ç®—å…ƒç´ çš„å‡ ä½•ä¿¡æ¯...
            </div>
          </div>
        </div>

        <!-- Stage 5: Paint -->
        <div class="stage" id="stage5">
          <h2>5ï¸âƒ£ Paint (ç»˜åˆ¶)</h2>
          <div class="stage-content" id="paintContent">
            <div style="margin-bottom: 1rem; color: #718096">
              ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤...
            </div>
          </div>
        </div>

        <!-- Stage 6: Composite -->
        <div class="stage" id="stage6">
          <h2>6ï¸âƒ£ Composite (åˆæˆ)</h2>
          <div class="stage-content" id="compositeContent">
            <div style="margin-bottom: 1rem; color: #718096">
              åˆæˆå›¾å±‚åˆ°å±å¹•...
            </div>
          </div>
        </div>
      </div>

      <!-- Final Render -->
      <div class="final-render">
        <h2>ğŸ–¥ï¸ æœ€ç»ˆæ¸²æŸ“ç»“æœ</h2>
        <div class="rendered-content" id="finalRender">
          <div style="text-align: center; color: #a0aec0; padding: 4rem">
            ç­‰å¾…æ¸²æŸ“å®Œæˆ...
          </div>
        </div>
      </div>
    </div>

    <script>
      let currentStep = 0;
      let autoPlayInterval = null;

      const steps = [
        {
          name: "HTML è§£æ â†’ DOM æ ‘æ„å»º",
          execute: buildDOM,
        },
        {
          name: "CSS è§£æ â†’ CSSOM æ„å»º",
          execute: buildCSSOM,
        },
        {
          name: "åˆå¹¶ DOM å’Œ CSSOM â†’ Render Tree",
          execute: buildRenderTree,
        },
        {
          name: "Layout è®¡ç®—å‡ ä½•ä¿¡æ¯",
          execute: performLayout,
        },
        {
          name: "Paint ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤",
          execute: performPaint,
        },
        {
          name: "Composite åˆæˆåˆ°å±å¹•",
          execute: performComposite,
        },
      ];

      function updateStepIndicator() {
        const indicator = document.getElementById("stepIndicator");
        if (currentStep < steps.length) {
          indicator.textContent = `æ­¥éª¤ ${currentStep + 1}/${steps.length}: ${
            steps[currentStep].name
          }`;
        } else {
          indicator.textContent = "âœ… æ¸²æŸ“å®Œæˆï¼";
        }
      }

      function buildDOM() {
        const stage = document.getElementById("stage1");
        const content = document.getElementById("domContent");
        stage.classList.add("active");

        content.innerHTML = `
          <div style="margin-bottom: 1rem; color: #718096;">
            HTML è§£æå™¨é€å­—ç¬¦è¯»å–ï¼Œç”Ÿæˆ Tokenï¼Œæ„å»º DOM æ ‘ï¼š
          </div>
          <div class="tree-node" id="dom-root">
            <div class="tree-node-name">Document</div>
          </div>
        `;

        setTimeout(() => {
          const root = document.getElementById("dom-root");
          root.innerHTML += `
            <div class="tree-node visible" style="transition-delay: 0.1s">
              <div class="tree-node-name">&lt;div class="container"&gt;</div>
              <div class="tree-node-type">HTMLDivElement</div>
              <div class="tree-node visible" style="transition-delay: 0.3s">
                <div class="tree-node-name">&lt;h1 class="title"&gt;</div>
                <div class="tree-node-type">HTMLHeadingElement</div>
                <div class="tree-node visible" style="transition-delay: 0.5s">
                  <div class="tree-node-type">#text: "Hello World"</div>
                </div>
              </div>
              <div class="tree-node visible" style="transition-delay: 0.7s">
                <div class="tree-node-name">&lt;p class="text"&gt;</div>
                <div class="tree-node-type">HTMLParagraphElement</div>
                <div class="tree-node visible" style="transition-delay: 0.9s">
                  <div class="tree-node-type">#text: "è¿™æ˜¯ä¸€æ®µæ–‡æœ¬"</div>
                </div>
              </div>
            </div>
          `;
          root.classList.add("visible");
        }, 100);
      }

      function buildCSSOM() {
        const prevStage = document.getElementById("stage1");
        prevStage.classList.remove("active");

        const stage = document.getElementById("stage2");
        const content = document.getElementById("cssomContent");
        stage.classList.add("active");

        content.innerHTML = `
          <div style="margin-bottom: 1rem; color: #718096;">
            CSS è§£æå™¨è§£ææ ·å¼è§„åˆ™ï¼Œæ„å»º CSSOMï¼š
          </div>
        `;

        const rules = [
          { selector: ".container", props: "width: 800px; margin: auto;" },
          { selector: ".title", props: "font-size: 32px; color: #667eea;" },
          { selector: ".text", props: "font-size: 16px; color: #333;" },
        ];

        rules.forEach((rule, index) => {
          setTimeout(() => {
            content.innerHTML += `
              <div class="css-rule visible" style="transition-delay: ${
                index * 0.2
              }s">
                <div><strong>${rule.selector}</strong> {</div>
                <div style="margin-left: 1rem;">${rule.props}</div>
                <div>}</div>
              </div>
            `;
          }, index * 400);
        });
      }

      function buildRenderTree() {
        const prevStage = document.getElementById("stage2");
        prevStage.classList.remove("active");

        const stage = document.getElementById("stage3");
        const content = document.getElementById("renderTreeContent");
        stage.classList.add("active");

        content.innerHTML = `
          <div style="margin-bottom: 1rem; color: #718096;">
            åˆå¹¶ DOM å’Œ CSSOMï¼Œåˆ›å»ºæ¸²æŸ“æ ‘ï¼ˆåªåŒ…å«å¯è§å…ƒç´ ï¼‰ï¼š
          </div>
        `;

        const items = [
          { tag: "div.container", styles: "width: 800px, margin: auto" },
          { tag: "h1.title", styles: "font-size: 32px, color: #667eea" },
          { tag: "p.text", styles: "font-size: 16px, color: #333" },
        ];

        items.forEach((item, index) => {
          setTimeout(() => {
            content.innerHTML += `
              <div class="render-item visible" style="transition-delay: ${
                index * 0.2
              }s">
                <div style="font-weight: bold; color: #667eea;">${
                  item.tag
                }</div>
                <div style="font-size: 0.85rem; color: #718096; margin-top: 0.3rem;">
                  è®¡ç®—æ ·å¼: ${item.styles}
                </div>
              </div>
            `;
          }, index * 400);
        });
      }

      function performLayout() {
        const prevStage = document.getElementById("stage3");
        prevStage.classList.remove("active");

        const stage = document.getElementById("stage4");
        const content = document.getElementById("layoutContent");
        stage.classList.add("active");

        content.innerHTML = `
          <div style="margin-bottom: 1rem; color: #718096;">
            ä»æ ¹èŠ‚ç‚¹éå†ï¼Œè®¡ç®—æ¯ä¸ªå…ƒç´ çš„ç²¾ç¡®ä½ç½®å’Œå°ºå¯¸ï¼ˆç›’æ¨¡å‹ï¼‰ï¼š
          </div>
        `;

        const boxes = [
          { name: "div.container", box: "x:0, y:0, w:800px, h:200px" },
          { name: "h1.title", box: "x:0, y:0, w:800px, h:50px" },
          { name: "p.text", box: "x:0, y:50, w:800px, h:30px" },
        ];

        boxes.forEach((box, index) => {
          setTimeout(() => {
            content.innerHTML += `
              <div class="layout-box visible" style="transition-delay: ${
                index * 0.2
              }s">
                <div class="layout-info">${box.box}</div>
                <div style="font-weight: bold; color: #4299e1;">${
                  box.name
                }</div>
                <div style="font-size: 0.8rem; color: #718096; margin-top: 0.3rem;">
                  è®¡ç®—: ç›’æ¨¡å‹ã€å®šä½ã€æµ®åŠ¨ã€æ–‡æœ¬æ¢è¡Œ
                </div>
              </div>
            `;
          }, index * 500);
        });
      }

      function performPaint() {
        const prevStage = document.getElementById("stage4");
        prevStage.classList.remove("active");

        const stage = document.getElementById("stage5");
        const content = document.getElementById("paintContent");
        stage.classList.add("active");

        content.innerHTML = `
          <div style="margin-bottom: 1rem; color: #718096;">
            ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤åˆ—è¡¨ï¼ˆDraw Callsï¼‰ï¼Œè½¬æ¢ä¸ºåƒç´ ï¼š
          </div>
        `;

        const drawCalls = [
          "ç»˜åˆ¶ div.container èƒŒæ™¯",
          "ç»˜åˆ¶ h1.title æ–‡å­—ï¼ˆHello Worldï¼‰",
          "ç»˜åˆ¶ p.text æ–‡å­—ï¼ˆè¿™æ˜¯ä¸€æ®µæ–‡æœ¬ï¼‰",
        ];

        drawCalls.forEach((call, index) => {
          setTimeout(() => {
            content.innerHTML += `
              <div class="paint-layer visible" style="transition-delay: ${
                index * 0.2
              }s">
                <div style="font-size: 0.9rem;">
                  ğŸ“ ${call}
                </div>
              </div>
            `;
          }, index * 500);
        });
      }

      function performComposite() {
        const prevStage = document.getElementById("stage5");
        prevStage.classList.remove("active");

        const stage = document.getElementById("stage6");
        const content = document.getElementById("compositeContent");
        stage.classList.add("active");

        content.innerHTML = `
          <div style="margin-bottom: 1rem; color: #718096;">
            åˆæˆçº¿ç¨‹å°†å„ä¸ªå›¾å±‚åˆæˆï¼Œå‘é€åˆ° GPU æ˜¾ç¤ºï¼š
          </div>
        `;

        const layers = [
          "Layer 0: ä¸»å›¾å±‚ï¼ˆåŒ…å« div.containerï¼‰",
          "Layer 1: æ–‡æœ¬å›¾å±‚ï¼ˆh1 + pï¼‰",
        ];

        layers.forEach((layer, index) => {
          setTimeout(() => {
            content.innerHTML += `
              <div class="composite-layer visible" style="transition-delay: ${
                index * 0.2
              }s">
                <div style="font-weight: bold; color: #48bb78;">ğŸ¨ ${layer}</div>
                <div style="font-size: 0.85rem; color: #718096; margin-top: 0.3rem;">
                  åœ¨ GPU ä¸Šåˆæˆ
                </div>
              </div>
            `;
          }, index * 400);
        });

        // Show final render
        setTimeout(() => {
          const finalRender = document.getElementById("finalRender");
          finalRender.innerHTML = `
            <div style="width: 800px; margin: auto; padding: 2rem; border: 2px solid #e2e8f0; border-radius: 8px; background: white;">
              <h1 style="font-size: 32px; color: #667eea; margin-bottom: 1rem;">Hello World</h1>
              <p style="font-size: 16px; color: #333;">è¿™æ˜¯ä¸€æ®µæ–‡æœ¬</p>
            </div>
            <div style="text-align: center; margin-top: 2rem; color: #48bb78; font-weight: bold;">
              âœ¨ æ¸²æŸ“å®Œæˆï¼æ¯ç§’ 60 å¸§æŒç»­åˆ·æ–°
            </div>
          `;
          finalRender.classList.add("visible");
        }, 1000);
      }

      function nextStep() {
        if (currentStep < steps.length) {
          steps[currentStep].execute();
          currentStep++;
          updateStepIndicator();
        }
      }

      function runFullDemo() {
        resetDemo();
        autoPlayInterval = setInterval(() => {
          if (currentStep < steps.length) {
            nextStep();
          } else {
            clearInterval(autoPlayInterval);
          }
        }, 2500);
      }

      function resetDemo() {
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
        }
        currentStep = 0;
        updateStepIndicator();

        // Reset all stages
        document.querySelectorAll(".stage").forEach((stage) => {
          stage.classList.remove("active");
        });

        // Reset content
        document.getElementById("domContent").innerHTML =
          '<div style="margin-bottom: 1rem; color: #718096;">HTML è§£æå™¨å°†å­—èŠ‚æµè½¬æ¢ä¸º DOM æ ‘...</div>';
        document.getElementById("cssomContent").innerHTML =
          '<div style="margin-bottom: 1rem; color: #718096;">CSS è§£æå™¨æ„å»º CSSOM æ ‘...</div>';
        document.getElementById("renderTreeContent").innerHTML =
          '<div style="margin-bottom: 1rem; color: #718096;">åˆå¹¶ DOM å’Œ CSSOM...</div>';
        document.getElementById("layoutContent").innerHTML =
          '<div style="margin-bottom: 1rem; color: #718096;">è®¡ç®—å…ƒç´ çš„å‡ ä½•ä¿¡æ¯...</div>';
        document.getElementById("paintContent").innerHTML =
          '<div style="margin-bottom: 1rem; color: #718096;">ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤...</div>';
        document.getElementById("compositeContent").innerHTML =
          '<div style="margin-bottom: 1rem; color: #718096;">åˆæˆå›¾å±‚åˆ°å±å¹•...</div>';

        const finalRender = document.getElementById("finalRender");
        finalRender.classList.remove("visible");
        finalRender.innerHTML =
          '<div style="text-align: center; color: #a0aec0; padding: 4rem;">ç­‰å¾…æ¸²æŸ“å®Œæˆ...</div>';
      }

      // Initialize
      updateStepIndicator();
    </script>
  </body>
</html>
