generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Player {
  id           String   @id @default(uuid())
  name         String   @unique
  soulPower    Int      @default(100)
  maxSoulPower Int      @default(100)
  level        SoulLevel @default(SOUL_TU)
  gold         Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  pactSlots  PactSlot[]
  pets       Pet[]
  inventory  Inventory[]
  saves      Save[]

  @@map("players")
}

enum SoulLevel {
  SOUL_TU     // 魂徒
  SOUL_SHI    // 魂士
  SOUL_SHI_YI // 魂师
  SOUL_ZHU    // 魂主
  SOUL_HUANG  // 魂皇
  SOUL_DI     // 魂帝
  SOUL_ZUN    // 魂尊
}

model PactSlot {
  id          String    @id @default(uuid())
  slotId      Int
  petUid      String?   @unique
  isLocked    Boolean   @default(false)
  unlockLevel SoulLevel?
  playerId    String
  player      Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  pet         Pet?      @relation(fields: [petUid], references: [uid])

  @@unique([playerId, slotId])
  @@map("pact_slots")
}

model Pet {
  uid             String   @id @default(uuid())
  playerId        String
  speciesId       String
  nickname        String?
  level           Int      @default(1)
  exp             Int      @default(0)
  hp              Int
  maxHp           Int
  stamina         Int
  maxStamina       Int
  loyalty         Int      @default(80)
  mutationPoints  Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  player    Player     @relation(fields: [playerId], references: [id], onDelete: Cascade)
  pactSlot  PactSlot?  @relation
  species   PetSpecies @relation(fields: [speciesId], references: [id])

  @@map("pets")
}

model PetSpecies {
  id          String     @id
  name        String
  rank        SpeciesRank
  elements    Json
  description String
  baseStats   Json
  skills      Json
  evolutions  Json
  createdAt   DateTime   @default(now())

  pets Pet[]

  @@map("pet_species")
}

enum SpeciesRank {
  SLAVE      // 奴仆级
  GENERAL    // 战将级
  COMMANDER  // 统领级
  MONARCH    // 君主级
  EMPEROR    // 帝皇级
  RULER      // 主宰级
  IMMORTAL   // 不朽级
}

model Skill {
  id          String   @id
  name        String
  element     String
  type        String
  power       Int
  cost        Int
  accuracy    Int
  description String
  effect      Json?

  @@map("skills")
}

model Inventory {
  id          String   @id @default(uuid())
  playerId    String
  itemId      String
  name        String
  type        String
  quantity    Int
  description String
  createdAt   DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("inventories")
}

model Save {
  id        String   @id @default(uuid())
  playerId  String
  saveName  String
  saveData  Json
  createdAt DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@map("saves")
}
