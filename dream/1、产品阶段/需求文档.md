# 《宠魅：灵魂羁绊》产品需求文档

## 1. 产品概述

### 1.1 项目背景
基于网络小说《宠魅》世界观开发的文字策略养成游戏，以魂宠捕捉、培养、战斗、异变为核心玩法，打造一款深度的单机RPG体验。

### 1.2 核心特色
- **异变系统**: 低级魂宠可通过奇遇异变为高级生物
- **魂宠师参与**: 主角需消耗魂力释放辅助技能，深度参与战斗
- **属性克制**: 多属性组合与克制关系，策略性强
- **生存压力**: 魂宠需吞噬灵核成长，特定魂宠需定期喂养

### 1.3 目标用户
- 《宠魅》小说爱好者
- 喜欢深度养成的策略RPG玩家
- 文字游戏爱好者

---

## 2. 功能需求

### 2.1 P0 核心功能 (必须完成)

#### 2.1.1 战斗系统
- [ ] 实现回合制战斗流程(召唤→指令→结算)
- [ ] 完成伤害计算公式(含属性克制、本系加成、随机浮动)
- [ ] 实现命中与闪避判定
- [ ] 支持魂宠师释放辅助魂技
- [ ] 状态异常系统(灼烧、冻结、中毒、睡眠)
- [ ] 战斗日志文字播报

#### 2.1.2 魂宠系统
- [ ] 魂宠数据加载(JSON格式)
- [ ] 基础属性系统(HP/Stamina/Attack/Defense/Speed)
- [ ] 技能系统(学习、释放、体力消耗)
- [ ] 成长系统(经验值、等级提升、属性成长)
- [ ] 异变系统(触发条件判定、种族变更)

#### 2.1.3 魂宠师系统
- [ ] 魂念等级(决定可契约魂宠数量)
- [ ] 魂力系统(召唤消耗、维持消耗、技能消耗)
- [ ] 魂约位管理(携带出战魂宠选择)
- [ ] 背包系统(灵核、魂装、药剂)

### 2.2 P1 重要功能 (第二优先级)

#### 2.2.1 探索与地图
- [ ] 地图节点系统(新月之地、囚岛、万象境等)
- [ ] 随机事件系统(野生魂宠遭遇、流浪魂宠师、天材地宝)
- [ ] 环境系统(暴风雨、烈日、夜晚，影响属性威力)

#### 2.2.2 魂宠捕捉
- [ ] 捕捉判定公式
- [ ] 灵核道具系统(提升捕捉成功率)
- [ ] 契约流程

#### 2.2.3 UI界面
- [ ] 战斗界面(魂宠状态、技能选择、战斗日志)
- [ ] 魂宠图鉴(查看魂宠信息、属性、技能)
- [ ] 魂宠管理界面(查看、强化、技能切换)
- [ ] 背包界面

### 2.3 P2 扩展功能 (后续优化)

#### 2.2.4 存档系统
- [ ] 自动存档(每次战斗/探索后)
- [ ] 多存档槽位支持

#### 2.2.5 成就系统
- [ ] 首次捕获特定魂宠
- [ ] 完成异变
- [ ] 击败特定BOSS

#### 2.2.6 音效与BGM
- [ ] 战斗BGM
- [ ] 探索BGM
- [ ] 技能音效

---

## 3. 用户故事

### 3.1 初次体验
> 作为一个新手玩家，我希望能够快速了解游戏规则，并通过新手教程完成第一次战斗和魂宠契约。

### 3.2 核心战斗
> 作为一名魂宠师，我希望能够指挥我的魂宠释放技能，并在关键时刻消耗魂力释放辅助技能，从而赢得战斗。

### 3.3 魂宠培养
> 作为一个培养爱好者，我希望通过战斗和吞噬灵核提升魂宠等级，并在特定条件下触发异变，获得更强大的魂宠。

### 3.4 探索发现
> 作为一个探索者，我希望在不同地图节点遭遇野生魂宠和稀有资源，丰富我的收藏和实力。

---

## 4. 技术架构

### 4.1 整体架构
采用前后端分离架构，前后端通过RESTful API通信。

```
┌─────────────────────────────────────────┐
│           前端 (Vue 3 + Vite)           │
│  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │  组件层  │  │ 状态管理 │  │  路由  │ │
│  └────┬─────┘  └────┬─────┘  └───┬────┘ │
│       └──────────────┼────────────┘    │
│                      ▼                  │
│  ┌───────────────────────────────┐     │
│  │     API服务层 (Axios)         │     │
│  └───────────────────────────────┘     │
└───────────────────┬───────────────────┘
                    │ HTTP/HTTPS
                    ▼
┌─────────────────────────────────────────┐
│         后端 (Node.js + Express)       │
│  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │  控制器  │  │  业务层  │  │ 数据层 │ │
│  └──────────┘  └──────────┘  └────────┘ │
└───────────────────┬───────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────┐
│        数据库 (PostgreSQL/MySQL)       │
│  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │ 魂宠表   │  │ 玩家表   │  │ 存档表 │ │
│  └──────────┘  └──────────┘  └────────┘ │
└─────────────────────────────────────────┘
```

### 4.2 前端技术栈
- **框架**: Vue 3 (Composition API) + Vite
- **UI库**: TailwindCSS + 自定义组件
- **状态管理**: Pinia
- **路由**: Vue Router
- **HTTP客户端**: Axios
- **表单验证**: Zod / VueUse
- **工具库**: Day.js, Lodash-es

### 4.3 后端技术栈（待选）
- **框架**: Node.js + Express / NestJS
- **ORM**: Prisma / TypeORM
- **数据库**: PostgreSQL / MySQL
- **认证**: JWT
- **验证**: Joi / Zod

### 4.4 前端目录结构
```
src/
├── api/                    # API接口定义
│   ├── index.ts            # Axios实例配置
│   ├── battle.ts           # 战斗相关接口
│   ├── pet.ts              # 魂宠相关接口
│   ├── player.ts           # 玩家相关接口
│   └── save.ts             # 存档相关接口
├── assets/                 # 静态资源
│   ├── images/
│   ├── sounds/
│   └── styles/
├── components/             # UI组件
│   ├── Battle/             # 战斗相关
│   │   ├── BattleView.vue  # 战斗主视图
│   │   ├── BattleLog.vue   # 战斗日志
│   │   ├── SkillPanel.vue  # 技能面板
│   │   └── PetStatus.vue   # 魂宠状态
│   ├── Pet/                # 魂宠相关
│   │   ├── PetCard.vue     # 魂宠卡片
│   │   ├── PetDetail.vue   # 魂宠详情
│   │   ├── PetEvolution.vue # 异变界面
│   │   └── PetDex.vue      # 魂宠图鉴
│   ├── Player/             # 玩家相关
│   │   ├── PlayerInfo.vue  # 玩家信息
│   │   ├── Inventory.vue   # 背包
│   │   └── SavePanel.vue   # 存档管理
│   └── Common/             # 通用组件
│       ├── Button.vue      # 按钮
│       ├── Modal.vue       # 弹窗
│       ├── ProgressBar.vue # 进度条
│       └── Toast.vue       # 提示
├── composables/            # 组合式函数
│   ├── useBattle.ts        # 战斗逻辑
│   ├── usePet.ts           # 魂宠逻辑
│   ├── usePlayer.ts        # 玩家逻辑
│   └── useStorage.ts      # 本地存储
├── router/                 # 路由配置
│   └── index.ts
├── stores/                 # Pinia状态
│   ├── battle.ts           # 战斗状态
│   ├── pet.ts              # 魂宠状态
│   ├── player.ts           # 玩家状态
│   └── ui.ts               # UI状态
├── types/                  # TypeScript类型
│   ├── pet.ts              # 魂宠类型
│   ├── skill.ts            # 技能类型
│   ├── battle.ts           # 战斗类型
│   └── player.ts           # 玩家类型
├── utils/                  # 工具函数
│   ├── calc.ts             # 计算函数
│   ├── format.ts           # 格式化
│   └── validate.ts         # 验证函数
├── views/                  # 页面视图
│   ├── Home.vue            # 首页
│   ├── Battle.vue          # 战斗页面
│   ├── PetManagement.vue   # 魂宠管理
│   ├── Exploration.vue     # 探索页面
│   └── Settings.vue        # 设置
├── App.vue
└── main.ts
```

### 4.5 后端API接口设计（核心接口）

#### 4.5.1 玩家相关
```typescript
// 获取玩家信息
GET /api/player/info
Response: { id, name, soulPower, maxSoulPower, level, pactSlots }

// 创建新玩家
POST /api/player/create
Body: { name }
Response: { playerId, initialPet }

// 更新玩家状态
PUT /api/player/update
Body: { soulPower, level, ... }
```

#### 4.5.2 魂宠相关
```typescript
// 获取玩家所有魂宠
GET /api/pets/list
Response: Pet[]

// 获取魂宠详情
GET /api/pets/:id
Response: Pet

// 魂宠进化/异变
POST /api/pets/:id/evolve
Body: { evolutionId, items }
Response: { success, newPet, logs }

// 魂宠升级
POST /api/pets/:id/level-up
Body: { exp, items }
Response: { success, newLevel, stats }
```

#### 4.5.3 战斗相关
```typescript
// 开始战斗（返回初始战斗状态）
POST /api/battle/start
Body: { playerPetId, enemyPetId }
Response: { battleId, initialState }

// 提交行动指令
POST /api/battle/:id/action
Body: { actionType, actionData }
Response: { result, battleState, logs }

// 战斗结算
POST /api/battle/:id/finish
Response: { rewards, exp, items }
```

#### 4.5.4 存档相关
```typescript
// 保存游戏
POST /api/save
Body: { saveData }
Response: { saveId, timestamp }

// 加载存档
GET /api/save/:id
Response: { saveData }

// 获取存档列表
GET /api/saves/list
Response: Save[]
```

### 4.6 前端状态管理设计

#### 4.6.1 Battle Store（战斗状态）
```typescript
interface BattleState {
  battleId: string
  round: number
  playerPet: PetInstance
  enemyPet: PetInstance
  battleLogs: BattleLog[]
  isPlayerTurn: boolean
  battleStatus: 'idle' | 'active' | 'finished'
}
```

#### 4.6.2 Pet Store（魂宠状态）
```typescript
interface PetState {
  pets: PetInstance[]
  activePet: PetInstance | null
  petDex: PetData[]  // 图鉴数据
}
```

#### 4.6.3 Player Store（玩家状态）
```typescript
interface PlayerState {
  player: Player
  inventory: InventoryItem[]
  pactSlots: PactSlot[]
}
```

### 4.7 前端核心组件设计

#### 4.7.1 战斗组件层级
```
BattleView (战斗容器)
├── EnemyPanel (敌方信息)
│   ├── EnemyAvatar (敌方头像)
│   └── EnemyStatus (敌方状态条)
├── PlayerPanel (我方信息)
│   ├── PlayerAvatar (我方头像)
│   └── PlayerStatus (我方状态条)
├── BattleScene (战斗场景)
│   └── PetSprite (魂宠精灵图)
├── ActionPanel (操作面板)
│   ├── SkillList (技能列表)
│   └── MasterActions (魂宠师技能)
└── BattleLog (战斗日志)
```

#### 4.7.2 魂宠管理组件层级
```
PetManagement (魂宠管理容器)
├── PetList (魂宠列表)
│   └── PetCard (魂宠卡片)
├── PetDetail (魂宠详情)
│   ├── PetStats (属性展示)
│   ├── SkillTree (技能树)
│   └── EvolutionTree (进化树)
└── PetActions (操作面板)
    ├── Train (训练)
    ├── Evolve (进化)
    └── Switch (切换)
```

### 4.8 数据流设计

#### 4.8.1 战斗数据流
```
用户点击技能
  ↓
Composable: useBattle.handleAction()
  ↓
API: POST /api/battle/:id/action
  ↓
Store: battle.$patch(newState)
  ↓
组件自动更新 (响应式)
  ↓
动画播放 + 日志显示
```

#### 4.8.2 异变数据流
```
用户点击异变按钮
  ↓
检查条件 (本地计算)
  ↓
API: POST /api/pets/:id/evolve
  ↓
Store: pet.updatePet(newPet)
  ↓
弹窗展示异变动画
  ↓
组件刷新显示
```

### 4.9 性能优化策略

#### 4.9.1 组件层面
- 使用 `v-once` 缓存静态内容
- 列表渲染使用 `v-memo` 避免不必要的更新
- 大列表使用虚拟滚动

#### 4.9.2 数据层面
- 魂宠数据使用 CDN 缓存
- 静态资源懒加载
- API请求防抖/节流

#### 4.9.3 渲染层面
- 使用 CSS transform 动画
- 图片使用 WebP 格式
- 关键路径资源预加载

### 4.10 错误处理与用户体验

#### 4.10.1 网络错误
```typescript
// Axios拦截器统一处理
axios.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      // 跳转登录
    } else if (error.response?.status === 500) {
      // 显示服务器错误提示
    }
    return Promise.reject(error)
  }
)
```

#### 4.10.2 离线支持
- 使用 Service Worker 缓存静态资源
- 关键战斗数据本地暂存
- 网络恢复后自动同步

### 4.11 开发工具链

#### 4.11.1 代码质量
- **ESLint**: 代码规范检查
- **Prettier**: 代码格式化
- **TypeScript**: 类型检查
- **Husky**: Git hooks
- **Commitlint**: 提交信息规范

#### 4.11.2 调试工具
- **Vue DevTools**: 组件调试
- **Pinia DevTools**: 状态调试
- **Axios Interceptor Log**: API请求日志

---

## 5. 前端开发规范

### 5.1 命名规范
- **组件**: PascalCase (e.g., `BattleView.vue`)
- **文件**: kebab-case (e.g., `battle-service.ts`)
- **变量**: camelCase (e.g., `playerHealth`)
- **常量**: SCREAMING_SNAKE_CASE (e.g., `MAX_SOUL_POWER`)
- **类型**: PascalCase (e.g., `interface PetInstance`)

### 5.2 组件开发规范
```vue
<template>
  <!-- 使用 v-if/v-show 区分 -->
  <!-- 列表使用 key -->
</template>

<script setup lang="ts">
// 1. 导入依赖
import { ref, computed } from 'vue'

// 2. 定义 Props
interface Props {
  pet: PetInstance
}
const props = defineProps<Props>()

// 3. 定义 Emits
const emit = defineEmits<{
  (e: 'click', id: string): void
}>()

// 4. 响应式状态
const isActive = ref(false)

// 5. 计算属性
const formattedHealth = computed(() => {
  return `${props.pet.health}/${props.pet.maxHealth}`
})

// 6. 方法
const handleClick = () => {
  emit('click', props.pet.id)
}
</script>

<style scoped>
/* 使用 scoped 避免样式污染 */
</style>
```

### 5.3 API调用规范
```typescript
// services/api/pet.ts
import axios from '@/api'

export const petApi = {
  // 获取列表
  getList: async (): Promise<PetInstance[]> => {
    const { data } = await axios.get('/api/pets/list')
    return data
  },

  // 获取详情
  getDetail: async (id: string): Promise<PetInstance> => {
    const { data } = await axios.get(`/api/pets/${id}`)
    return data
  }
}
```

### 5.4 Composables设计规范
```typescript
// composables/useBattle.ts
import { ref } from 'vue'
import { battleApi } from '@/api/battle'

export function useBattle() {
  const battleState = ref<BattleState | null>(null)

  const startBattle = async (playerPetId: string, enemyPetId: string) => {
    const result = await battleApi.start({ playerPetId, enemyPetId })
    battleState.value = result
  }

  const handleAction = async (action: BattleAction) => {
    const result = await battleApi.action(battleState.value!.battleId, action)
    battleState.value = result.battleState
  }

  return {
    battleState,
    startBattle,
    handleAction
  }
}
```

---

## 6. 开发计划

### 6.1 第一阶段 (前端基础设施 + 后端API) - 2周

#### 前端任务 (你主要负责)
- [ ] 搭建Vue3 + Vite + TypeScript项目
- [ ] 配置TailwindCSS + ESLint + Prettier
- [ ] 创建基础目录结构
- [ ] 配置Axios拦截器和错误处理
- [ ] 实现路由基础配置 (Home/Battle/Pet Management)
- [ ] 创建Pinia Store基础骨架 (battle/pet/player)
- [ ] 实现通用组件 (Button/Modal/Toast/ProgressBar)
- [ ] 设计响应式布局框架

#### 后端任务 (需要后端配合)
- [ ] 搭建Node.js + Express项目
- [ ] 配置数据库连接 (PostgreSQL)
- [ ] 设计数据库表结构 (玩家/魂宠/存档/技能)
- [ ] 实现基础API接口 (玩家注册/登录/信息查询)
- [ ] 实现魂宠数据查询接口
- [ ] 编写API文档 (Swagger/OpenAPI)

#### 交付物
- 前端项目框架可运行
- 后端API基础接口可调用
- 前后端联通，可以查询玩家和魂宠数据

---

### 6.2 第二阶段 (战斗系统核心) - 3周

#### 前端任务
- [ ] 实现BattleView战斗主视图
- [ ] 实现PetStatus魂宠状态组件
- [ ] 实现BattleLog战斗日志组件
- [ ] 实现SkillPanel技能选择面板
- [ ] 实现useBattle Composable
- [ ] 实现战斗动画效果 (攻击/受伤/技能释放)
- [ ] 实现伤害计算和命中判定
- [ ] 实现状态异常UI表现 (灼烧/冻结/中毒)

#### 后端任务
- [ ] 实现战斗核心算法 (伤害计算/命中判定)
- [ ] 实现战斗状态管理接口
- [ ] 实现行动指令处理接口
- [ ] 实现战斗结算接口
- [ ] 实现技能效果数据库

#### 交付物
- 完整的1v1战斗系统可玩
- 可以释放技能、计算伤害、展示日志
- 前后端数据流转正常

---

### 6.3 第三阶段 (魂宠系统核心) - 2周

#### 前端任务
- [ ] 实现PetManagement魂宠管理页面
- [ ] 实现PetCard魂宠卡片组件
- [ ] 实现PetDetail魂宠详情组件
- [ ] 实现PetEvolution异变界面
- [ ] 实现PetDex魂宠图鉴
- [ ] 实现usePet Composable
- [ ] 实现魂宠成长进度条和动画

#### 后端任务
- [ ] 实现魂宠升级接口
- [ ] 实现异变判定逻辑
- [ ] 实现异变处理接口
- [ ] 实现技能学习接口
- [ ] 扩充魂宠数据到50+种

#### 交付物
- 魂宠管理完整功能
- 可以查看、升级、异变魂宠
- 魂宠图鉴可浏览

---

### 6.4 第四阶段 (玩家系统 + 探索) - 2周

#### 前端任务
- [ ] 实现PlayerInfo玩家信息组件
- [ ] 实现Inventory背包界面
- [ ] 实现SavePanel存档管理界面
- [ ] 实现Exploration探索页面
- [ ] 实现地图节点选择界面
- [ ] 实现随机事件弹窗

#### 后端任务
- [ ] 实现玩家状态更新接口
- [ ] 实现背包物品管理接口
- [ ] 实现存档保存/加载/删除接口
- [ ] 实现随机事件生成逻辑
- [ ] 实现地图节点数据管理

#### 交付物
- 玩家信息、背包、存档系统完整
- 探索系统基本可用，可以触发随机事件

---

### 6.5 第五阶段 (捕捉系统 + 完善) - 2周

#### 前端任务
- [ ] 实现捕捉界面和动画
- [ ] 实现契约流程UI
- [ ] 完善战斗AI (敌方行动逻辑)
- [ ] 实现设置页面 (音量/画质/存档管理)
- [ ] UI美化和动画优化
- [ ] 添加加载动画和过渡效果

#### 后端任务
- [ ] 实现捕捉判定算法
- [ ] 实现契约接口
- [ ] 实现战斗AI逻辑
- [ ] 性能优化和缓存策略
- [ ] 接口限流和安全加固

#### 交付物
- 魂宠捕捉系统可用
- 游戏流程完整闭环
- UI/UX达到可发布标准

---

### 6.6 第六阶段 (测试 + 发布) - 1周

#### 前端任务
- [ ] 全功能测试
- [ ] 兼容性测试 (浏览器适配)
- [ ] 性能测试和优化
- [ ] Bug修复
- [ ] 编写部署脚本

#### 后端任务
- [ ] 压力测试
- [ ] 数据库优化
- [ ] 日志系统完善
- [ ] 监控告警配置
- [ ] 备份恢复测试

#### 交付物
- 完整可发布的1.0版本
- 用户手册和开发文档
- 部署文档和运维文档

---

## 7. 数据模型定义

### 7.1 前端TypeScript类型定义

#### 7.1.1 魂宠类型
```typescript
// types/pet.ts

export interface PetData {
  id: string
  name: string
  rank: SpeciesRank
  elements: Element[]
  description: string
  baseStats: BaseStats
  skills: PetSkill[]
  evolutions: Evolution[]
}

export interface PetInstance extends PetData {
  uid: string                    // 唯一实例ID
  nickname: string               // 昵称
  level: number                  // 当前等级 (1-100)
  exp: number                    // 当前经验
  maxExp: number                 // 升级所需经验
  stats: BattleStats             // 当前战斗属性
  hp: number                     // 当前HP
  maxHp: number                  // 最大HP
  stamina: number                // 当前体力
  maxStamina: number             // 最大体力
  learnedSkills: string[]        // 已学习技能ID
  loyalty: number                // 忠诚度 (0-100)
  mutationPoints: number         // 异变积分
}

export type SpeciesRank =
  | '奴仆级'
  | '战将级'
  | '统领级'
  | '君主级'
  | '帝皇级'
  | '主宰级'
  | '不朽级'

export type Element =
  | '兽'
  | '妖灵'
  | '火'
  | '冰'
  | '雷'
  | '风'
  | '木'
  | '虫'
  | '鬼'
  | '龙'
  | '光'
  | '暗'

export interface BaseStats {
  health: number
  stamina: number
  attack: number
  defense: number
  speed: number
}

export interface BattleStats {
  hp: number
  maxHp: number
  stamina: number
  maxStamina: number
  attack: number
  defense: number
  speed: number
}

export interface PetSkill {
  learnLevel: number
  skillId: string
  name: string
}

export interface Evolution {
  targetId: string
  type: 'evolution' | 'mutation'
  condition: EvolutionCondition
}

export interface EvolutionCondition {
  minLevel?: number
  itemNeeded?: string
  environment?: string
  description?: string
}
```

#### 7.1.2 技能类型
```typescript
// types/skill.ts

export interface SkillData {
  id: string
  name: string
  element: Element
  type: SkillType
  power: number
  cost: number
  accuracy: number
  description: string
  effect?: SkillEffect
}

export type SkillType = '物理' | '魔法' | '辅助' | '防御' | '控制'

export interface SkillEffect {
  type: 'damage' | 'heal' | 'buff' | 'debuff' | 'status'
  value?: number
  statusType?: StatusType
  duration?: number
}

export type StatusType = 'burn' | 'freeze' | 'poison' | 'sleep'
```

#### 7.1.3 战斗类型
```typescript
// types/battle.ts

import { PetInstance } from './pet'

export interface BattleState {
  battleId: string
  round: number
  playerPet: PetInstance
  enemyPet: PetInstance
  battleLogs: BattleLog[]
  isPlayerTurn: boolean
  battleStatus: BattleStatus
  environment?: string
}

export type BattleStatus = 'idle' | 'active' | 'finished'

export interface BattleLog {
  id: string
  round: number
  source: 'player' | 'enemy' | 'system'
  type: 'attack' | 'skill' | 'damage' | 'heal' | 'status' | 'evolution' | 'system'
  message: string
  value?: number
  timestamp: number
}

export interface BattleAction {
  type: 'attack' | 'skill' | 'item' | 'defend' | 'switch'
  skillId?: string
  itemId?: string
  petId?: string
}

export interface BattleResult {
  winner: 'player' | 'enemy'
  exp: number
  items: Item[]
  gold: number
}
```

#### 7.1.4 玩家类型
```typescript
// types/player.ts

import { PetInstance } from './pet'

export interface Player {
  id: string
  name: string
  soulPower: number
  maxSoulPower: number
  level: SoulLevel
  pactSlots: PactSlot[]
  inventory: InventoryItem[]
  gold: number
}

export type SoulLevel =
  | '魂徒'
  | '魂士'
  | '魂师'
  | '魂主'
  | '魂皇'
  | '魂帝'
  | '魂尊'

export interface PactSlot {
  slotId: number
  petUid: string | null
  isLocked: boolean
  unlockLevel?: SoulLevel
}

export interface InventoryItem {
  itemId: string
  name: string
  type: 'soul_core' | 'item' | 'equipment'
  quantity: number
  description: string
}

export interface Item {
  id: string
  name: string
  type: string
  effect: any
  value: number
  description: string
}
```

### 7.2 后端数据库设计

#### 7.2.1 玩家表 (players)
```sql
CREATE TABLE players (
  id VARCHAR(36) PRIMARY KEY,
  name VARCHAR(50) NOT NULL UNIQUE,
  soul_power INT DEFAULT 100,
  max_soul_power INT DEFAULT 100,
  level VARCHAR(20) DEFAULT '魂徒',
  gold INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### 7.2.2 魂宠表 (pets)
```sql
CREATE TABLE pets (
  uid VARCHAR(36) PRIMARY KEY,
  player_id VARCHAR(36) NOT NULL,
  species_id VARCHAR(10) NOT NULL,
  nickname VARCHAR(50),
  level INT DEFAULT 1,
  exp INT DEFAULT 0,
  hp INT,
  max_hp INT,
  stamina INT,
  max_stamina INT,
  loyalty INT DEFAULT 80,
  mutation_points INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (player_id) REFERENCES players(id)
);
```

#### 7.2.3 魂宠品种表 (pet_species)
```sql
CREATE TABLE pet_species (
  id VARCHAR(10) PRIMARY KEY,
  name VARCHAR(50) NOT NULL,
  rank VARCHAR(20) NOT NULL,
  elements JSON NOT NULL,
  description TEXT,
  base_stats JSON NOT NULL,
  skills JSON NOT NULL,
  evolutions JSON
);
```

#### 7.2.4 技能表 (skills)
```sql
CREATE TABLE skills (
  id VARCHAR(10) PRIMARY KEY,
  name VARCHAR(50) NOT NULL,
  element VARCHAR(20) NOT NULL,
  type VARCHAR(20) NOT NULL,
  power INT DEFAULT 0,
  cost INT DEFAULT 10,
  accuracy INT DEFAULT 100,
  description TEXT,
  effect JSON
);
```

#### 7.2.5 存档表 (saves)
```sql
CREATE TABLE saves (
  id VARCHAR(36) PRIMARY KEY,
  player_id VARCHAR(36) NOT NULL,
  save_name VARCHAR(100),
  save_data JSON NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (player_id) REFERENCES players(id)
);
```

---

## 8. 前端关键技术点

### 8.1 响应式状态管理
使用 Pinia 进行状态管理，配合 Composition API 实现响应式更新。

```typescript
// stores/battle.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

export const useBattleStore = defineStore('battle', () => {
  const state = ref<BattleState | null>(null)
  const logs = ref<BattleLog[]>([])

  const isPlayerTurn = computed(() => state.value?.isPlayerTurn ?? false)
  const battleStatus = computed(() => state.value?.battleStatus ?? 'idle')

  const setState = (newState: BattleState) => {
    state.value = newState
  }

  const addLog = (log: BattleLog) => {
    logs.value.push(log)
  }

  const reset = () => {
    state.value = null
    logs.value = []
  }

  return {
    state,
    logs,
    isPlayerTurn,
    battleStatus,
    setState,
    addLog,
    reset
  }
})
```

### 8.2 异步数据加载
使用 Composables 封装异步逻辑。

```typescript
// composables/usePet.ts
import { ref, onMounted } from 'vue'
import { petApi } from '@/api/pet'

export function usePet(petId: string) {
  const pet = ref<PetInstance | null>(null)
  const loading = ref(false)
  const error = ref<Error | null>(null)

  const fetchPet = async () => {
    loading.value = true
    error.value = null
    try {
      pet.value = await petApi.getDetail(petId)
    } catch (e) {
      error.value = e as Error
    } finally {
      loading.value = false
    }
  }

  onMounted(() => {
    fetchPet()
  })

  return {
    pet,
    loading,
    error,
    refresh: fetchPet
  }
}
```

### 8.3 路由守卫
使用 Vue Router 守卫保护路由。

```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import { usePlayerStore } from '@/stores/player'

const routes = [
  {
    path: '/',
    name: 'home',
    component: () => import('@/views/Home.vue')
  },
  {
    path: '/battle',
    name: 'battle',
    component: () => import('@/views/Battle.vue'),
    meta: { requiresAuth: true }
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes
})

router.beforeEach((to, from, next) => {
  const playerStore = usePlayerStore()

  if (to.meta.requiresAuth && !playerStore.player) {
    next({ name: 'home' })
  } else {
    next()
  }
})

export default router
```

---

## 9. 非功能需求

### 9.1 性能
- 战斗操作响应时间 < 200ms
- API请求平均响应时间 < 500ms
- 首屏加载时间 < 2s
- 支持主流浏览器(Chrome/Firefox/Edge/Safari)
- 支持10000+魂宠数据流畅渲染

### 9.2 可维护性
- 代码结构清晰，模块化设计
- 关键算法添加注释
- 数据与逻辑分离
- 单元测试覆盖率 > 70%

### 9.3 可扩展性
- 新增魂宠无需修改核心代码
- 技能系统支持动态扩展
- 支持多语言扩展(预留i18n接口)
- 支持插件式扩展新玩法

### 9.4 安全性
- API接口鉴权(JWT Token)
- XSS/CSRF防护
- 敏感操作二次确认
- 存档数据加密存储

### 9.5 可用性
- 离线缓存支持(Service Worker)
- 自动存档机制
- 数据备份与恢复
- 完善的错误提示和引导

---

## 10. 附录

### 10.1 已有资源
- 魂宠数据: `data/soul_pets.json` (11种魂宠)
- 技能数据: `data/skills.json` (16个技能)
- 数据验证脚本: `scripts/verify_data.py/js`
- 战斗模拟器: `scripts/battle_sim.js`

### 10.2 设计文档
- 游戏概念设计: `1、开始畅想.md`
- 魂宠数据库设计: `2、魂宠数据库设计.md`
- 战斗系统设计: `3、战斗系统设计.md`
- 产品需求文档: `产品/需求文档.md` (本文档)

### 10.3 技术参考资料
- Vue 3 官方文档: https://vuejs.org/
- Pinia 官方文档: https://pinia.vuejs.org/
- TailwindCSS 官方文档: https://tailwindcss.com/
- TypeScript 官方文档: https://www.typescriptlang.org/
- Express 官方文档: https://expressjs.com/
- Prisma 官方文档: https://www.prisma.io/

### 10.4 开发工具推荐
- **IDE**: VS Code + Volar插件
- **API测试**: Postman / Insomnia
- **数据库管理**: pgAdmin / DBeaver
- **版本控制**: Git + GitHub/GitLab
- **项目协作**: GitHub Projects / Trello

---

**文档版本**: v2.0
**创建日期**: 2026-01-04
**最后更新**: 2026-01-04
**维护人员**: 前端团队
**技术栈**: Vue 3 + TypeScript + Node.js + PostgreSQL
