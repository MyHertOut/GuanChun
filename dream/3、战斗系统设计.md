# 战斗系统设计文档

本文档定义了《宠魅：灵魂羁绊》的核心战斗规则与公式。

## 1. 基础属性定义

*   **HP (生命值)**: 降为0时失去战斗能力。
*   **Stamina (体力)**: 释放技能消耗。若不足则无法行动或强制休息。
*   **Attack (攻击)**: 物理/魔法攻击的基础值。
*   **Defense (防御)**: 抵挡伤害的能力。
*   **Speed (速度)**: 决定行动顺序和闪避率。

## 2. 战斗流程 (回合制)

1.  **准备阶段**: 双方魂宠师消耗魂力召唤魂宠。
2.  **指令阶段**:
    *   玩家选择魂宠技能。
    *   玩家可选择消耗魂力释放辅助魂技（如：加速、护盾）。
3.  **结算阶段**:
    *   按 **速度** 排序决定出手顺序。
    *   执行技能效果，扣除体力与HP。
    *   判定状态效果（灼烧、冰冻等）。

## 3. 核心公式

### 3.1 伤害计算公式 (Damage Calculation)

```
Damage = ( (Attacker_Level * 0.4 + 2) * Skill_Power * (Attacker_Attack / Defender_Defense) / 50 + 2 ) * Modifier
```

**Modifier (修正系数)** 包含：
*   **属性克制 (Type Effectiveness)**: 
    *   克制 (如火打木) = 2.0
    *   被克 (如火打水) = 0.5
    *   无效果 = 0.0
*   **本系加成 (STAB)**: 魂宠属性与技能属性一致 = 1.5
*   **随机浮动**: 0.85 ~ 1.00

### 3.2 命中与闪避 (Hit & Evasion)

*   **基础命中率**: 技能自带命中率 (通常100%)。
*   **速度修正**: 
    ```
    Hit_Chance = Base_Accuracy * (Attacker_Speed / Defender_Speed)
    ```
    *(注: 设定上限100%，下限30%)*

### 3.3 魂力消耗 (Soul Power)

魂宠师的魂力是战略资源。

*   **召唤魂宠**: 消耗 = `Pet_Rank_Base_Cost` (如战将级10点，统领级30点)。
*   **维持形态**: 每回合消耗少量魂力 (越高等级消耗越大)。
*   **魂技**: 
    *   `宠魅` (加攻速): 消耗 20
    *   `魂念守护` (护盾): 消耗 30

## 4. 状态异常 (Status Effects)

*   **灼烧 (Burn)**: 每回合损失 1/16 最大HP，且物理攻击减半。
*   **冻结 (Freeze)**: 无法行动，受到火系攻击伤害增加但解除冻结。
*   **中毒 (Poison)**: 每回合损失 HP，随回合数增加而加重。
*   **睡眠 (Sleep)**: 无法行动 1-3 回合。

## 5. 异变触发判定 (Mutation Trigger)

异变不是随机的，而是基于 **隐藏积分 (Mutation Points)**。

*   **积分来源**:
    *   使用特定属性技能次数。
    *   吞噬特定灵物。
    *   濒死状态下击败强敌。
*   **触发**: 战斗结束时，若积分达标且满足特定环境条件，触发进化/异变选项。
